--- a/server/server.c
+++ b/server/server.c
@@ -1942,11 +1942,11 @@ int main(int argc, char **argv)
             LOGE("invalid protocol");
             return 1;
         }
-        free(protocol);
         memset(protocol, 0x00, length);
         memcpy(protocol, text, length);
         protocol[length] = '\0';
+        free(protocol);
     }
 
     if (server_host == NULL) {
